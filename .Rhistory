}
lambaacc_prob_45<-data.frame(pivot_lambdaacc_45[,1:8],Prlambda=prob_lambdaacc_45_post)
# class(climate_cmc45_values)
geo_prlambdaacc_45 <- merge(x = lambaacc_prob_45,y =climate_acc_45_values,by=c("pptdorm","tempdorm"),all.x=TRUE)
# summary(geo_prlambdacmc_45)
(lambda_map_Pracc45 <- ggplot()+
# geom_map(data = outline_map, map = outline_map, aes(map_id = region), color = "grey", linewidth = .1, fill = "#FAF9F6")+
# coord_sf(xlim = c(-110,-90), ylim = c(25,45)) +
geom_tile(data = geo_prlambdaacc_45, aes(x = x, y = y, fill = Prlambda))+
# geom_point(data=poar_occ_1990_2019,aes(lon, lat),alpha=1/5)+
annotate(geom="text", x=-100, y=41, label="RCP4.5",
color="grey",size = 3)+
scale_fill_gradientn(
name = expression("Pr " (lambda) > 1),
colours = terrain.colors(7),
breaks = seq(0, 1, 0.2))+
theme_light()+
theme(strip.background = element_blank(),
strip.text  = element_text(face = "italic", color = "black"))+
labs(x = "Longitude", y = "Latitude",title="C") )
lambbaacc85 %>%
unique %>%
pivot_wider( values_from = 'lambda_diff',
names_from  = 'posterior_id' )->pivot_lambdacc_85
#dim(pivot_lambda_current)
# Calculate probability of lambda above 1
prob_lambdaacc_85_post<-c()
for(l in 1:nrow(pivot_lambdacc_85)){
prob_lambdaacc_85_post[l]<-mean(pivot_lambdacc_85[l,]>1,na.rm=T)
}
lambdaacc_prob_85<-data.frame(pivot_lambdacc_85[,1:8],Prlambda=prob_lambdaacc_85_post)
geo_prlambdaacc_85 <- merge(x = lambdaacc_prob_85,y =climate_acc_85_values,by=c("pptdorm","tempdorm")) # merge the demographic data with climatic data for each
# summary(geo_prlambda_current)
(lambda_map_Pracc85 <- ggplot()+
# geom_map(data = outline_map, map = outline_map, aes(map_id = region), color = "grey", linewidth = .1, fill = "#FAF9F6")+
# coord_sf(xlim = c(-110,-90), ylim = c(25,45)) +
geom_tile(data = geo_prlambdaacc_85, aes(x = x, y = y, fill = Prlambda))+
# geom_point(data=poar_occ_1990_2019,aes(lon, lat),alpha=1/5)+
annotate(geom="text", x=-100, y=41, label="RCP8.5",
color="grey",size = 3)+
scale_fill_gradientn(
name = expression("Pr " (lambda) > 1),
colours = terrain.colors(7))+
theme_light()+
theme(strip.background = element_blank(),
strip.text  = element_text(face = "italic", color = "black"))+
labs(x = "Longitude", y = "Latitude",title="D") )
Fig_geoPrlambdacmcprojection<-ggarrange(lambda_map_Prpast, lambda_map_Prcurrent, lambda_map_Pracc45, lambda_map_Pracc85,common.legend = TRUE)
ggsave("/Users/jm200/Library/CloudStorage/Dropbox/Miller Lab/github/POAR-Forecasting/Manuscript/Figures/Fig_geoPrlambdaprojection_acc.pdf", Fig_geoPrlambdacmcprojection, width = 5, height = 7)
lambbaces45 %>%
unique %>%
pivot_wider( values_from = 'lambda_diff',
names_from  = 'posterior_id' )->pivot_lambdaces_45
#dim(pivot_lambda_current)
# Calculate probability of lambda above 1
prob_lambdaces_45_post<-c()
for(l in 1:nrow(pivot_lambdaces_45)){
prob_lambdaces_45_post[l]<-mean(pivot_lambdaces_45[l,]>1,na.rm=T)
}
lambaces_prob_45<-data.frame(pivot_lambdaces_45[,1:8],Prlambda=prob_lambdaces_45_post)
# class(climate_cmc45_values)
geo_prlambdaces_45 <- merge(x = lambaces_prob_45,y =climate_ces_45_values,by=c("pptdorm","tempdorm"),all.x=TRUE)
# summary(geo_prlambdacmc_45)
(lambda_map_Prces45 <- ggplot()+
# geom_map(data = outline_map, map = outline_map, aes(map_id = region), color = "grey", linewidth = .1, fill = "#FAF9F6")+
# coord_sf(xlim = c(-110,-90), ylim = c(25,45)) +
geom_tile(data = geo_prlambdaces_45, aes(x = x, y = y, fill = Prlambda))+
# geom_point(data=poar_occ_1990_2019,aes(lon, lat),alpha=1/5)+
annotate(geom="text", x=-100, y=41, label="RCP4.5",
color="grey",size = 3)+
scale_fill_gradientn(
name = expression("Pr " (lambda) > 1),
colours = terrain.colors(7),
breaks = seq(0, 1, 0.2))+
theme_light()+
theme(strip.background = element_blank(),
strip.text  = element_text(face = "italic", color = "black"))+
labs(x = "Longitude", y = "Latitude",title="C") )
lambbaces85 %>%
unique %>%
pivot_wider( values_from = 'lambda_diff',
names_from  = 'posterior_id' )->pivot_lambdaces_85
#dim(pivot_lambda_current)
# Calculate probability of lambda above 1
prob_lambdaces_85_post<-c()
for(l in 1:nrow(pivot_lambdaces_85)){
prob_lambdaces_85_post[l]<-mean(pivot_lambdaces_85[l,]>1,na.rm=T)
}
lambdaces_prob_85<-data.frame(pivot_lambdaces_85[,1:8],Prlambda=prob_lambdaces_85_post)
geo_prlambdaces_85 <- merge(x = lambdaces_prob_85,y =climate_ces_85_values,by=c("pptdorm","tempdorm")) # merge the demographic data with climatic data for each
# summary(geo_prlambda_current)
geo_prlambdaces_85 <- merge(x = lambdaces_prob_85,y =climate_ces_85_values,by=c("pptdorm","tempdorm")) # merge the demographic data with climatic data for each
# summary(geo_prlambda_current)
(lambda_map_Prces85 <- ggplot()+
# geom_map(data = outline_map, map = outline_map, aes(map_id = region), color = "grey", linewidth = .1, fill = "#FAF9F6")+
# coord_sf(xlim = c(-110,-90), ylim = c(25,45)) +
geom_tile(data = geo_prlambdaces_85, aes(x = x, y = y, fill = Prlambda))+
# geom_point(data=poar_occ_1990_2019,aes(lon, lat),alpha=1/5)+
annotate(geom="text", x=-100, y=41, label="RCP8.5",
color="grey",size = 3)+
scale_fill_gradientn(
name = expression("Pr " (lambda) > 1),
colours = terrain.colors(7))+
theme_light()+
theme(strip.background = element_blank(),
strip.text  = element_text(face = "italic", color = "black"))+
labs(x = "Longitude", y = "Latitude",title="D") )
Fig_geoPrlambdacesprojection<-ggarrange(lambda_map_Prpast, lambda_map_Prcurrent, lambda_map_Prces45, lambda_map_Prces85,common.legend = TRUE)
ggsave("/Users/jm200/Library/CloudStorage/Dropbox/Miller Lab/github/POAR-Forecasting/Manuscript/Figures/Fig_geoPrlambdaprojection_ces.pdf", Fig_geoPrlambdacmcprojection, width = 5, height = 7)
geo_lambbacurrent_fd <- read.csv("https://www.dropbox.com/scl/fi/7zmsid3dxszv3l3tyvoox/lambda_post_current.csv?rlkey=hwy253ls9imsupkzqrduwp7r8&dl=1", stringsAsFactors = F)
geo_lambbapast_fd <- read.csv("https://www.dropbox.com/scl/fi/9x9gbdv1vefdyd292726c/data_past_fd.csv?rlkey=besdw6mj9ab1nubx18if54w9z&dl=1", stringsAsFactors = F)
geo_lambda_miroc45_fd<-read.csv("https://www.dropbox.com/scl/fi/dmfb2mdhrv5k8otcrc33m/lambda_miroc45.csv?rlkey=1d4j1blbmlx9i3rp61c35g7f8&dl=1", stringsAsFactors = F)
geo_lambba_miroc85_fd <- read.csv("https://www.dropbox.com/scl/fi/a1rmqszey6y9s88887fqq/datamiroc85fd.csv?rlkey=1eckoajb6s4ee6dq61f2o5ymj&dl=1", stringsAsFactors = F)
# geo_lambba_cmc45_fd <- read.csv("https://www.dropbox.com/scl/fi/boqyl8ltowyunjf8x3m3w/lambda_cmcc45_post.csv?rlkey=ciwqlt3a97c2khthujotrryil&dl=1", stringsAsFactors = F)
# geolambba_cmc85_fd <- read.csv("https://www.dropbox.com/scl/fi/4eke3xp4gasqe5r8bk5c5/lambda_cmcc85_post.csv?rlkey=mginyfh8hbpmib6dbs8cmjq3f&dl=1", stringsAsFactors = F)
geo_lambba_acc45_fd <- read.csv("https://www.dropbox.com/scl/fi/p7xkr30t6zf24gtn4adbl/data_acc45_fd.csv?rlkey=2qv22qe7p3bahmn24mmtff1rm&dl=1", stringsAsFactors = F)
geolambba_acc85_fd <- read.csv("https://www.dropbox.com/scl/fi/5ged79dtckp3z2k570sm8/data_acc85_fd.csv?rlkey=l97zn5wfci6icbbvv8gcj6z5c&dl=1", stringsAsFactors = F)
geo_lambba_ces45_fd <- read.csv("https://www.dropbox.com/scl/fi/zdj4ra2qaghb4y16uiuow/data_ces45_fd.csv?rlkey=wl8t4ih9s48dr674xti0wwwww&dl=1", stringsAsFactors = F)
geolambba_ces85_fd <- read.csv("https://www.dropbox.com/scl/fi/e4mksgd5hpayfwd3oy0sz/data_ces85_fd.csv?rlkey=miacot7xh5yan0vk6nbwk9q1o&dl=1", stringsAsFactors = F)
prob_lambda_past_fd<-c()
for(l in 1:ncol(geo_lambbapast_fd)){
prob_lambda_past_fd[l]<-mean(geo_lambbapast_fd[,l]>1,na.rm=T)
}
clim_past_values_clean<-na.omit(clim_past_values)
lam_prob_past_fd<-data.frame(clim_past_values_clean[,9:10],Prlambda=prob_lambda_past_fd)
(lambda_map_Prpast_fd <- ggplot()+
# geom_map(data = outline_map, map = outline_map, aes(map_id = region), color = "grey", linewidth = .1, fill = "#FAF9F6")+
# coord_sf(xlim = c(-107,-92), ylim = c(25,41)) +
geom_tile(data = lam_prob_past_fd, aes(x = x, y = y, fill = Prlambda))+
annotate(geom="text", x=-100, y=41, label="Past",
color="grey",size = 3)+
scale_fill_gradientn(
name = expression("Pr " (lambda) > 1),
colours = terrain.colors(10),
breaks = seq(0, 1, 0.2))+
theme_light()+
theme(strip.background = element_blank(),
strip.text  = element_text(face = "italic", color = "black"))+
labs(x = "Longitude", y = "Latitude",title="A") )
prob_lambda_current_fd<-c()
for(l in 1:ncol(geo_lambbacurrent_fd)){
prob_lambda_current_fd[l]<-mean(geo_lambbacurrent_fd[,l]>1,na.rm=T)
}
lam_prob_current_fd<-data.frame(clim_current_values[,9:10],Prlambda=prob_lambda_current_fd)
(lambda_map_Prcurrent_fd <- ggplot()+
# geom_map(data = outline_map, map = outline_map, aes(map_id = region), color = "grey", linewidth = .1, fill = "#FAF9F6")+
# coord_sf(xlim = c(-110,-90), ylim = c(25,45)) +
geom_tile(data = lam_prob_current_fd, aes(x = x, y = y, fill = Prlambda))+
geom_point(data=poar_occ_1990_2019,aes(lon, lat),alpha=1/5)+
annotate(geom="text", x=-100, y=41, label="Current",
color="grey",size = 3)+
scale_fill_gradientn(
name = expression("Pr " (lambda) > 1),
colours = terrain.colors(10),
breaks = seq(0, 1, 0.2))+
theme_light()+
theme(strip.background = element_blank(),
strip.text  = element_text(face = "italic", color = "black"))+
labs(x = "Longitude", y = "Latitude",title="B") )
prob_lambda_miroc45_fd<-c()
dim(geo_lambda_miroc45_fd)
for(l in 1:ncol(geo_lambda_miroc45_fd)){
prob_lambda_miroc45_fd[l]<-mean(geo_lambda_miroc45_fd[,l]>1,na.rm=T)
}
lam_prob_miroc45_fd<-data.frame(climate_miroc45_values[,9:10],Prlambda=prob_lambda_miroc45_fd)
(lambda_map_miroc45_fd <- ggplot()+
# geom_map(data = outline_map, map = outline_map, aes(map_id = region), color = "grey", linewidth = .1, fill = "#FAF9F6")+
# coord_sf(xlim = c(-110,-90), ylim = c(25,45)) +
geom_tile(data = lam_prob_miroc45_fd, aes(x = x, y = y, fill = Prlambda))+
annotate(geom="text", x=-100, y=41, label="RCP4.5",
color="grey",size = 3)+
scale_fill_gradientn(
name = expression("Pr " (lambda) > 1),
colours = terrain.colors(10),
breaks = seq(0, 1, 0.2))+
theme_light()+
theme(strip.background = element_blank(),
strip.text  = element_text(face = "italic", color = "black"))+
labs(x = "Longitude", y = "Latitude",title="C") )
prob_lambda_miroc85_fd<-c()
dim(geo_lambba_miroc85_fd)
for(l in 1:ncol(geo_lambba_miroc85_fd)){
prob_lambda_miroc85_fd[l]<-mean(geo_lambba_miroc85_fd[,l]>1,na.rm=T)
}
lam_prob_miroc85_fd<-data.frame(climate_miroc85_values[,9:10],Prlambda=prob_lambda_miroc85_fd)
(lambda_map_miroc85_fd <- ggplot()+
# geom_map(data = outline_map, map = outline_map, aes(map_id = region), color = "grey", linewidth = .1, fill = "#FAF9F6")+
# coord_sf(xlim = c(-110,-90), ylim = c(25,45)) +
geom_tile(data = lam_prob_miroc85_fd, aes(x = x, y = y, fill = Prlambda))+
annotate(geom="text", x=-100, y=41, label="RCP8.5",
color="grey",size = 3)+
scale_fill_gradientn(
name = expression("Pr " (lambda) > 1),
colours = terrain.colors(10),
breaks = seq(0, 1, 0.2))+
theme_light()+
theme(strip.background = element_blank(),
strip.text  = element_text(face = "italic", color = "black"))+
labs(x = "Longitude", y = "Latitude",title="D") )
Fig_geoPrlambdacmcprojection_fd_miroc<-ggarrange(lambda_map_Prpast_fd, lambda_map_Prcurrent_fd, lambda_map_miroc45_fd, lambda_map_miroc85_fd,common.legend = TRUE)
ggsave("/Users/jm200/Library/CloudStorage/Dropbox/Miller Lab/github/POAR-Forecasting/Manuscript/Figures/Fig_geoPrlambdaprojection_fd_miroc.pdf", Fig_geoPrlambdacmcprojection_fd_miroc, width = 5, height = 7)
prob_lambda_cmc45_fd<-c()
dim(geo_lambba_cmc45_fd)
prob_lambda_cmc45_fd<-c()
dim(geo_lambba_cmc45_fd)
prob_lambda_acc45_fd<-c()
dim(geo_lambba_acc45_fd)
for(l in 1:ncol(geo_lambba_acc45_fd)){
prob_lambda_acc45_fd[l]<-mean(geo_lambba_acc45_fd[,l]>1,na.rm=T)
}
lam_prob_acc45_fd<-data.frame(climate_acc_45_values[,9:10],Prlambda=prob_lambda_acc45_fd)
(lambda_map_acc45_fd <- ggplot()+
# geom_map(data = outline_map, map = outline_map, aes(map_id = region), color = "grey", linewidth = .1, fill = "#FAF9F6")+
# coord_sf(xlim = c(-110,-90), ylim = c(25,45)) +
geom_tile(data = lam_prob_acc45_fd, aes(x = x, y = y, fill = Prlambda))+
annotate(geom="text", x=-100, y=41, label="RCP4.5",
color="grey",size = 3)+
scale_fill_gradientn(
name = expression("Pr " (lambda) > 1),
colours = terrain.colors(10),
breaks = seq(0, 1, 0.2))+
theme_light()+
theme(strip.background = element_blank(),
strip.text  = element_text(face = "italic", color = "black"))+
labs(x = "Longitude", y = "Latitude",title="C") )
prob_lambda_acc85_fd<-c()
dim(geolambba_acc85_fd)
for(l in 1:ncol(geolambba_acc85_fd)){
prob_lambda_acc85_fd[l]<-mean(geolambba_acc85_fd[,l]>1,na.rm=T)
}
lam_prob_acc85_fd<-data.frame(climate_acc_85_values[,9:10],Prlambda=prob_lambda_acc85_fd)
(lambda_map_acc85_fd <- ggplot()+
# geom_map(data = outline_map, map = outline_map, aes(map_id = region), color = "grey", linewidth = .1, fill = "#FAF9F6")+
# coord_sf(xlim = c(-110,-90), ylim = c(25,45)) +
geom_tile(data = lam_prob_acc85_fd, aes(x = x, y = y, fill = Prlambda))+
annotate(geom="text", x=-100, y=41, label="RCP8.5",
color="grey",size = 3)+
scale_fill_gradientn(
name = expression("Pr " (lambda) > 1),
colours = terrain.colors(10),
breaks = seq(0, 1, 0.2))+
theme_light()+
theme(strip.background = element_blank(),
strip.text  = element_text(face = "italic", color = "black"))+
labs(x = "Longitude", y = "Latitude",title="C") )
Fig_geoPrlambdacmcprojection_fd_acc<-ggarrange(lambda_map_Prpast_fd, lambda_map_Prcurrent_fd, lambda_map_acc45_fd, lambda_map_acc85_fd,common.legend = TRUE)
ggsave("/Users/jm200/Library/CloudStorage/Dropbox/Miller Lab/github/POAR-Forecasting/Manuscript/Figures/Fig_geoPrlambdaprojection_fd_acc.pdf", Fig_geoPrlambdacmcprojection_fd_acc, width = 5, height = 7)
prob_lambda_ces45_fd<-c()
dim(geo_lambba_ces45_fd)
for(l in 1:ncol(geo_lambba_ces45_fd)){
prob_lambda_ces45_fd[l]<-mean(geo_lambba_ces45_fd[,l]>1,na.rm=T)
}
lam_prob_ces45_fd<-data.frame(climate_ces_45_values[,9:10],Prlambda=prob_lambda_ces45_fd)
(lambda_map_ces45_fd <- ggplot()+
# geom_map(data = outline_map, map = outline_map, aes(map_id = region), color = "grey", linewidth = .1, fill = "#FAF9F6")+
# coord_sf(xlim = c(-110,-90), ylim = c(25,45)) +
geom_tile(data = lam_prob_ces45_fd, aes(x = x, y = y, fill = Prlambda))+
annotate(geom="text", x=-100, y=41, label="RCP4.5",
color="grey",size = 3)+
scale_fill_gradientn(
name = expression("Pr " (lambda) > 1),
colours = terrain.colors(10),
breaks = seq(0, 1, 0.2))+
theme_light()+
theme(strip.background = element_blank(),
strip.text  = element_text(face = "italic", color = "black"))+
labs(x = "Longitude", y = "Latitude",title="C") )
prob_lambda_ces85_fd<-c()
dim(geolambba_ces85_fd)
for(l in 1:ncol(geolambba_ces85_fd)){
prob_lambda_ces85_fd[l]<-mean(geolambba_ces85_fd[,l]>1,na.rm=T)
}
lam_prob_ces85_fd<-data.frame(climate_ces_85_values[,9:10],Prlambda=prob_lambda_ces85_fd)
(lambda_map_ces85_fd <- ggplot()+
# geom_map(data = outline_map, map = outline_map, aes(map_id = region), color = "grey", linewidth = .1, fill = "#FAF9F6")+
# coord_sf(xlim = c(-110,-90), ylim = c(25,45)) +
geom_tile(data = lam_prob_ces85_fd, aes(x = x, y = y, fill = Prlambda))+
annotate(geom="text", x=-100, y=41, label="RCP8.5",
color="grey",size = 3)+
scale_fill_gradientn(
name = expression("Pr " (lambda) > 1),
colours = terrain.colors(10),
breaks = seq(0, 1, 0.2))+
theme_light()+
theme(strip.background = element_blank(),
strip.text  = element_text(face = "italic", color = "black"))+
labs(x = "Longitude", y = "Latitude",title="D") )
Fig_geoPrlambdacmcprojection_fd_ces<-ggarrange(lambda_map_Prpast_fd, lambda_map_Prcurrent_fd, lambda_map_ces45_fd, lambda_map_ces85_fd,common.legend = TRUE)
ggsave("/Users/jm200/Library/CloudStorage/Dropbox/Miller Lab/github/POAR-Forecasting/Manuscript/Figures/Fig_geoPrlambdaprojection_fd_ces.pdf", Fig_geoPrlambdacmcprojection_fd_miroc, width = 5, height = 7)
# Z score
zclim_current = data.frame(matrix(nrow = 14, ncol = 4))
colnames(zclim_current)<-c("zpptgrow","ztempgrow","zpptdorm","ztempdorm")
zclim_current$zpptgrow<-(clim_current$pptgrow-mean(poar_2015_2016$pptgrow))/sd(poar_2015_2016$pptgrow)
zclim_current$ztempgrow<-(clim_current$tempgrow-mean(poar_2015_2016$tempgrow))/sd(poar_2015_2016$tempgrow)
zclim_current$zpptdorm<-(clim_current$pptdorm-mean(poar_2015_2016$pptdorm))/sd(poar_2015_2016$pptdorm)
zclim_current$ztempdorm<-(clim_current$tempdorm-mean(poar_2015_2016$tempdorm))/sd(poar_2015_2016$tempdorm)
zclim_past = data.frame(matrix(nrow = 14, ncol = 4))
colnames(zclim_past)<-c("zpptgrow","ztempgrow","zpptdorm","ztempdorm")
zclim_past$zpptgrow<-(clim_past$pptgrow-mean(poar_2015_2016$pptgrow))/sd(poar_2015_2016$pptgrow)
zclim_past$ztempgrow<-(clim_past$tempgrow-mean(poar_2015_2016$tempgrow))/sd(poar_2015_2016$tempgrow)
zclim_past$zpptdorm<-(clim_past$pptdorm-mean(poar_2015_2016$pptdorm))/sd(poar_2015_2016$pptdorm)
zclim_past$ztempdorm<-(clim_past$tempdorm-mean(poar_2015_2016$tempdorm))/sd(poar_2015_2016$tempdorm)
zclim_miroc45 = data.frame(matrix(nrow = 14, ncol = 4))
colnames(zclim_miroc45)<-c("zpptgrow","ztempgrow","zpptdorm","ztempdorm")
zclim_miroc45$zpptgrow<-(clim_miroc45$pptgrow-mean(poar_2015_2016$pptgrow))/sd(poar_2015_2016$pptgrow)
zclim_miroc45$ztempgrow<-(clim_miroc45$tempgrow-mean(poar_2015_2016$tempgrow))/sd(poar_2015_2016$tempgrow)
zclim_miroc45$zpptdorm<-(clim_miroc45$pptdorm-mean(poar_2015_2016$pptdorm))/sd(poar_2015_2016$pptdorm)
zclim_miroc45$ztempdorm<-(clim_miroc45$tempdorm-mean(poar_2015_2016$tempdorm))/sd(poar_2015_2016$tempdorm)
zclim_acc45 = data.frame(matrix(nrow = 14, ncol = 4))
colnames(zclim_acc45)<-c("zpptgrow","ztempgrow","zpptdorm","ztempdorm")
zclim_acc45$zpptgrow<-(clim_access45$pptgrow-mean(poar_2015_2016$pptgrow))/sd(poar_2015_2016$pptgrow)
zclim_acc45$ztempgrow<-(clim_access45$tempgrow-mean(poar_2015_2016$tempgrow))/sd(poar_2015_2016$tempgrow)
zclim_acc45$zpptdorm<-(clim_access45$pptdorm-mean(poar_2015_2016$pptdorm))/sd(poar_2015_2016$pptdorm)
zclim_acc45$ztempdorm<-(clim_access45$tempdorm-mean(poar_2015_2016$tempdorm))/sd(poar_2015_2016$tempdorm)
zclim_cmc45 = data.frame(matrix(nrow = 14, ncol = 4))
colnames(zclim_cmc45)<-c("zpptgrow","ztempgrow","zpptdorm","ztempdorm")
zclim_cmc45$zpptgrow<-(clim_cmcc45$pptgrow-mean(poar_2015_2016$pptgrow))/sd(poar_2015_2016$pptgrow)
zclim_cmc45$ztempgrow<-(clim_cmcc45$tempgrow-mean(poar_2015_2016$tempgrow))/sd(poar_2015_2016$tempgrow)
zclim_cmc45$zpptdorm<-(clim_cmcc45$pptdorm-mean(poar_2015_2016$pptdorm))/sd(poar_2015_2016$pptdorm)
zclim_cmc45$ztempdorm<-(clim_cmcc45$tempdorm-mean(poar_2015_2016$tempdorm))/sd(poar_2015_2016$tempdorm)
zclim_ces45 = data.frame(matrix(nrow = 14, ncol = 4))
colnames(zclim_ces45)<-c("zpptgrow","ztempgrow","zpptdorm","ztempdorm")
zclim_ces45$zpptgrow<-(clim_cesm45$pptgrow-mean(poar_2015_2016$pptgrow))/sd(poar_2015_2016$pptgrow)
zclim_ces45$ztempgrow<-(clim_cesm45$tempgrow-mean(poar_2015_2016$tempgrow))/sd(poar_2015_2016$tempgrow)
zclim_ces45$zpptdorm<-(clim_cesm45$pptdorm-mean(poar_2015_2016$pptdorm))/sd(poar_2015_2016$pptdorm)
zclim_ces45$ztempdorm<-(clim_cesm45$tempdorm-mean(poar_2015_2016$tempdorm))/sd(poar_2015_2016$tempdorm)
data_site_pptgrow45<-data.frame(zclim_miroc45$zpptgrow,zclim_acc45$zpptgrow,zclim_cmc45$zpptgrow,zclim_ces45$zpptgrow)
data_site_tempgrow45<-data.frame(zclim_miroc45$ztempgrow,zclim_acc45$ztempgrow,zclim_cmc45$ztempgrow,zclim_ces45$ztempgrow)
data_site_pptdorm45<-data.frame(zclim_miroc45$zpptdorm,zclim_acc45$zpptdorm,zclim_cmc45$zpptdorm,zclim_ces45$zpptdorm)
data_site_tempdorm45<-data.frame(zclim_miroc45$ztempdorm,zclim_acc45$ztempdorm,zclim_cmc45$ztempdorm,zclim_ces45$ztempdorm)
data_site_45<-data.frame(zpptgrow=rowMeans(data_site_pptgrow45),ztempgrow=rowMeans(data_site_tempgrow45),zpptdorm=rowMeans(data_site_pptdorm45),ztempdorm=rowMeans(data_site_tempdorm45))
zclim_miroc85 = data.frame(matrix(nrow = 14, ncol = 4))
colnames(zclim_miroc85)<-c("zpptgrow","ztempgrow","zpptdorm","ztempdorm")
zclim_miroc85$zpptgrow<-(clim_miroc85$pptgrow-mean(poar_2015_2016$pptgrow))/sd(poar_2015_2016$pptgrow)
zclim_miroc85$ztempgrow<-(clim_miroc85$tempgrow-mean(poar_2015_2016$tempgrow))/sd(poar_2015_2016$tempgrow)
zclim_miroc85$zpptdorm<-(clim_miroc85$pptdorm-mean(poar_2015_2016$pptdorm))/sd(poar_2015_2016$pptdorm)
zclim_miroc85$ztempdorm<-(clim_miroc85$tempdorm-mean(poar_2015_2016$tempdorm))/sd(poar_2015_2016$tempdorm)
zclim_acc85 = data.frame(matrix(nrow = 14, ncol = 4))
colnames(zclim_acc85)<-c("zpptgrow","ztempgrow","zpptdorm","ztempdorm")
zclim_acc85$zpptgrow<-(clim_access85$pptgrow-mean(poar_2015_2016$pptgrow))/sd(poar_2015_2016$pptgrow)
zclim_acc85$ztempgrow<-(clim_access85$tempgrow-mean(poar_2015_2016$tempgrow))/sd(poar_2015_2016$tempgrow)
zclim_acc85$zpptdorm<-(clim_access85$pptdorm-mean(poar_2015_2016$pptdorm))/sd(poar_2015_2016$pptdorm)
zclim_acc85$ztempdorm<-(clim_access85$tempdorm-mean(poar_2015_2016$tempdorm))/sd(poar_2015_2016$tempdorm)
zclim_cmc85 = data.frame(matrix(nrow = 14, ncol = 4))
colnames(zclim_cmc85)<-c("zpptgrow","ztempgrow","zpptdorm","ztempdorm")
zclim_cmc85$zpptgrow<-(clim_cmcc85$pptgrow-mean(poar_2015_2016$pptgrow))/sd(poar_2015_2016$pptgrow)
zclim_cmc85$ztempgrow<-(clim_cmcc85$tempgrow-mean(poar_2015_2016$tempgrow))/sd(poar_2015_2016$tempgrow)
zclim_cmc85$zpptdorm<-(clim_cmcc85$pptdorm-mean(poar_2015_2016$pptdorm))/sd(poar_2015_2016$pptdorm)
zclim_cmc85$ztempdorm<-(clim_cmcc85$tempdorm-mean(poar_2015_2016$tempdorm))/sd(poar_2015_2016$tempdorm)
zclim_ces85 = data.frame(matrix(nrow = 14, ncol = 4))
colnames(zclim_ces85)<-c("zpptgrow","ztempgrow","zpptdorm","ztempdorm")
zclim_ces85$zpptgrow<-(clim_cesm85$pptgrow-mean(poar_2015_2016$pptgrow))/sd(poar_2015_2016$pptgrow)
zclim_ces85$ztempgrow<-(clim_cesm85$tempgrow-mean(poar_2015_2016$tempgrow))/sd(poar_2015_2016$tempgrow)
zclim_ces85$zpptdorm<-(clim_cesm85$pptdorm-mean(poar_2015_2016$pptdorm))/sd(poar_2015_2016$pptdorm)
zclim_ces85$ztempdorm<-(clim_cesm85$tempdorm-mean(poar_2015_2016$tempdorm))/sd(poar_2015_2016$tempdorm)
data_site_pptgrow85<-data.frame(zclim_miroc85$zpptgrow,zclim_acc85$zpptgrow,zclim_cmc85$zpptgrow,zclim_ces85$zpptgrow)
data_site_tempgrow85<-data.frame(zclim_miroc85$ztempgrow,zclim_acc85$ztempgrow,zclim_cmc85$ztempgrow,zclim_ces85$ztempgrow)
data_site_pptdorm85<-data.frame(zclim_miroc85$zpptdorm,zclim_acc85$zpptdorm,zclim_cmc85$zpptdorm,zclim_ces85$zpptdorm)
data_site_tempdorm85<-data.frame(zclim_miroc85$ztempdorm,zclim_acc85$ztempdorm,zclim_cmc85$ztempdorm,zclim_ces85$ztempdorm)
data_site_85<-data.frame(zpptgrow=rowMeans(data_site_pptgrow85),ztempgrow=rowMeans(data_site_tempgrow85),zpptdorm=rowMeans(data_site_pptdorm85),ztempdorm=rowMeans(data_site_tempdorm85))
data_past_present_45_85<-rbind(zclim_past,zclim_current,data_site_45,data_site_85)
# write_csv(data_past_present_45_85,"/Users/jm200/Library/CloudStorage/Dropbox/Miller Lab/Forecasting Models output/Climatic data/Niche/data_past_present_45_85.csv")
pptgrow_seq<-seq(min(data_past_present_45_85$zpptgrow),max(data_past_present_45_85$zpptgrow),length.out=30)
## read LTRE output
POAR_LTRE_PPTGROW <- readRDS(url("https://www.dropbox.com/scl/fi/eu9xnhl0qfizaoom3uj88/POAR_LTREPPTGROW.rds?rlkey=l70j7j7n18cli9wosi4m5pgzs&dl=1"))
# put it all together
LTRE_PPTGROW_out <- POAR_LTRE_PPTGROW$dp_dpptgrow * POAR_LTRE_PPTGROW$dlambda_dp
tempgrow_seq<-seq(min(data_past_present_45_85$ztempgrow),max(data_past_present_45_85$ztempgrow),length.out=30)
## read LTRE output
POAR_LTRE_TEMPGROW <- readRDS(url("https://www.dropbox.com/scl/fi/o3zaudgef040befdqdj2j/POAR_LTRETEMPGROW.rds?rlkey=cqy74r3mw0vtvx0r6obhlmk0f&dl=1"))
# put it all together
LTRE_TEMPGROW_out <- POAR_LTRE_TEMPGROW$dp_dtempgrow * POAR_LTRE_TEMPGROW$dlambda_dp
all_pptdorm_seq<-seq(min(data_past_present_45_85$zpptdorm),max(data_past_present_45_85$zpptdorm),length.out=30)
## read LTRE output
POAR_LTRE_PPTDORM <- readRDS(url("https://www.dropbox.com/scl/fi/fppc6kjqx1cgayk7wf95w/POAR_LTREPPTDORM.rds?rlkey=qrv2r9atakg7e2hlhof4xoyzs&dl=1"))
# put it all together
LTRE_PPTDORM_out <- POAR_LTRE_PPTDORM$dp_dpptdorm * POAR_LTRE_PPTDORM$dlambda_dp
all_tempdorm_seq<-seq(min(data_past_present_45_85$ztempdorm),max(data_past_present_45_85$ztempdorm),length.out=30)
## read LTRE output
POAR_LTRE_TEMPDORM <- readRDS(url("https://www.dropbox.com/scl/fi/l6lpwgi11lb4qkks501sh/POAR_LTRETEMPDORM.rds?rlkey=m9m0jw9qsrutr7z31rkl3hdp1&dl=1"))
# put it all together
LTRE_TEMPDORM_out <- POAR_LTRE_TEMPDORM$dp_dtempdorm * POAR_LTRE_TEMPDORM$dlambda_dp
# ltre_cols <- c("#D55E00",NA,"#56B4E9",NA,"#009E73",NA,"#CC79A7",NA)
ltre_cols <- c("#7570B3",NA,"#0072B2",NA,"#E7298A",NA,"#E6AB02",NA)
ltre_lty <- c(1,NA,1,NA,1,NA,1,NA)
pdf("/Users/jm200/Library/CloudStorage/Dropbox/Miller Lab/github/POAR-Forecasting/Manuscript/Figures/LTRE_Temperature.pdf",width=7,height=7,useDingbats = F)
par(oma=c(5,2,1.5,0.5))
# par(mar=c(5,4,1,0),mfrow=c(2,2))
par(mar=c(5,5,1,1),mfrow=c(2,2))
plot(tempgrow_seq*sd(poar_2015_2016$tempgrow) + mean(poar_2015_2016$tempgrow),colSums(LTRE_TEMPGROW_out[1:8,]),type="l",lwd=3,col="grey20",lty=1,
xlab="Temperature growing",ylab=expression(paste(partialdiff,lambda," / ",partialdiff,"tempgrow")),ylim=c(-5,5),cex.lab=1.2)
sex.symbols(9, -3, sex = 2, cex = 1.5, lwd = 2, col = "black")
abline(h=0,col="black")
for(i in seq(1,8,by=2)){
lines(tempgrow_seq*sd(poar_2015_2016$tempgrow) + mean(poar_2015_2016$tempgrow),colSums(LTRE_TEMPGROW_out[i:(i+1),]),lty=ltre_lty[i],col=ltre_cols[i],lwd=2)
}
mtext( "A",side = 3, adj = 0,cex=1.25)
# legend("topright",bty="n",legend=c("Survival","Growth","Flowering","Panicles","Total"),lwd=c(2,2,2,2,4),
#        lty=c(na.omit(ltre_lty),2),col=c(na.omit(ltre_cols),"grey20"),cex=0.8,seg.len =1)
plot(tempgrow_seq*sd(poar_2015_2016$tempgrow) + mean(poar_2015_2016$tempgrow),colSums(LTRE_TEMPGROW_out[9:16,]),type="l",lwd=3,col="grey20",
xlab="Temperature growing",ylab=expression(paste(partialdiff,lambda," / ",partialdiff,"tempgrow")),ylim=c(-5,5),cex.lab=1.2)
sex.symbols(9, -3, sex = 1, cex = 1.5, lwd = 2, col = "black")
abline(h=0,col="black")
for(i in seq(9,16,by=2)){
lines(tempgrow_seq*sd(poar_2015_2016$tempgrow) + mean(poar_2015_2016$tempgrow),colSums(LTRE_TEMPGROW_out[i:(i+1),]),lty=ltre_lty[i-8],col=ltre_cols[i-8],lwd=2)
}
mtext( "B",side = 3, adj = 0,cex=1.25)
legend("topright",bty="n",legend=c("Survival","Growth","Flowering","Panicles","Total"),lwd=c(2,2,2,2,3),
lty=c(na.omit(ltre_lty),1),col=c(na.omit(ltre_cols),"grey20"),cex=0.8)
# par(mar=c(5,5,1,1),mfrow=c(2,1))
plot(all_tempdorm_seq*sd(poar_2015_2016$tempdorm) + mean(poar_2015_2016$tempdorm),colSums(LTRE_TEMPDORM_out[1:8,]),type="l",lwd=3,col="grey20",lty=1,
xlab="Temperature dormant",ylab=expression(paste(partialdiff,lambda," / ",partialdiff,"tempdorm")),ylim=c(-5,5),cex.lab=1.2)
abline(h=0,col="black")
for(i in seq(1,8,by=2)){
lines(all_tempdorm_seq*sd(poar_2015_2016$tempdorm) + mean(poar_2015_2016$tempdorm),colSums(LTRE_TEMPDORM_out[i:(i+1),]),lty=ltre_lty[i],col=ltre_cols[i],lwd=2)
}
sex.symbols(25, -4, sex = 2, cex = 1.5, lwd = 2, col = "black")
mtext( "C",side = 3, adj = 0,cex=1.25)
plot(all_tempdorm_seq*sd(poar_2015_2016$tempdorm) + mean(poar_2015_2016$tempdorm),colSums(LTRE_TEMPDORM_out[9:16,]),type="l",lwd=3,col="grey20",
xlab="Temperature dormant",ylab=expression(paste(partialdiff,lambda," / ",partialdiff,"tempdorm")),ylim=c(-5,5),cex.lab=1.2)
abline(h=0,col="black")
for(i in seq(9,16,by=2)){
lines(all_tempdorm_seq*sd(poar_2015_2016$tempdorm) + mean(poar_2015_2016$tempdorm),colSums(LTRE_TEMPDORM_out[i:(i+1),]),lty=ltre_lty[i-8],col=ltre_cols[i-8],lwd=2)
}
sex.symbols(25, -4, sex = 1, cex = 1.5, lwd = 2, col = "black")
mtext( "D",side = 3, adj = 0,cex=1.25)
dev.off()
par(mar=c(5,5,1,1),mfrow=c(2,2))
plot(tempgrow_seq*sd(poar_2015_2016$tempgrow) + mean(poar_2015_2016$tempgrow),colSums(LTRE_TEMPGROW_out[1:8,]),type="l",lwd=3,col="grey20",lty=1,
xlab="Temperature growing",ylab=expression(paste(partialdiff,lambda," / ",partialdiff,"tempgrow")),ylim=c(-5,5),cex.lab=1.2)
sex.symbols(9, -3, sex = 2, cex = 1.5, lwd = 2, col = "black")
abline(h=0,col="black")
for(i in seq(1,8,by=2)){
lines(tempgrow_seq*sd(poar_2015_2016$tempgrow) + mean(poar_2015_2016$tempgrow),colSums(LTRE_TEMPGROW_out[i:(i+1),]),lty=ltre_lty[i],col=ltre_cols[i],lwd=2)
}
mtext( "A",side = 3, adj = 0,cex=1.25)
# legend("topright",bty="n",legend=c("Survival","Growth","Flowering","Panicles","Total"),lwd=c(2,2,2,2,4),
#        lty=c(na.omit(ltre_lty),2),col=c(na.omit(ltre_cols),"grey20"),cex=0.8,seg.len =1)
plot(tempgrow_seq*sd(poar_2015_2016$tempgrow) + mean(poar_2015_2016$tempgrow),colSums(LTRE_TEMPGROW_out[9:16,]),type="l",lwd=3,col="grey20",
xlab="Temperature growing",ylab=expression(paste(partialdiff,lambda," / ",partialdiff,"tempgrow")),ylim=c(-5,5),cex.lab=1.2)
sex.symbols(9, -3, sex = 1, cex = 1.5, lwd = 2, col = "black")
abline(h=0,col="black")
for(i in seq(9,16,by=2)){
lines(tempgrow_seq*sd(poar_2015_2016$tempgrow) + mean(poar_2015_2016$tempgrow),colSums(LTRE_TEMPGROW_out[i:(i+1),]),lty=ltre_lty[i-8],col=ltre_cols[i-8],lwd=2)
}
mtext( "B",side = 3, adj = 0,cex=1.25)
legend("topright",bty="n",legend=c("Survival","Growth","Flowering","Panicles","Total"),lwd=c(2,2,2,2,3),
lty=c(na.omit(ltre_lty),1),col=c(na.omit(ltre_cols),"grey20"),cex=0.8)
# par(mar=c(5,5,1,1),mfrow=c(2,1))
plot(all_tempdorm_seq*sd(poar_2015_2016$tempdorm) + mean(poar_2015_2016$tempdorm),colSums(LTRE_TEMPDORM_out[1:8,]),type="l",lwd=3,col="grey20",lty=1,
xlab="Temperature dormant",ylab=expression(paste(partialdiff,lambda," / ",partialdiff,"tempdorm")),ylim=c(-5,5),cex.lab=1.2)
abline(h=0,col="black")
for(i in seq(1,8,by=2)){
lines(all_tempdorm_seq*sd(poar_2015_2016$tempdorm) + mean(poar_2015_2016$tempdorm),colSums(LTRE_TEMPDORM_out[i:(i+1),]),lty=ltre_lty[i],col=ltre_cols[i],lwd=2)
}
sex.symbols(25, -4, sex = 2, cex = 1.5, lwd = 2, col = "black")
mtext( "C",side = 3, adj = 0,cex=1.25)
plot(all_tempdorm_seq*sd(poar_2015_2016$tempdorm) + mean(poar_2015_2016$tempdorm),colSums(LTRE_TEMPDORM_out[9:16,]),type="l",lwd=3,col="grey20",
xlab="Temperature dormant",ylab=expression(paste(partialdiff,lambda," / ",partialdiff,"tempdorm")),ylim=c(-5,5),cex.lab=1.2)
abline(h=0,col="black")
for(i in seq(9,16,by=2)){
lines(all_tempdorm_seq*sd(poar_2015_2016$tempdorm) + mean(poar_2015_2016$tempdorm),colSums(LTRE_TEMPDORM_out[i:(i+1),]),lty=ltre_lty[i-8],col=ltre_cols[i-8],lwd=2)
}
sex.symbols(25, -4, sex = 1, cex = 1.5, lwd = 2, col = "black")
mtext( "D",side = 3, adj = 0,cex=1.25)
geo_lambba_cmc45_fd <- read.csv("https://www.dropbox.com/scl/fi/oarso87jb6q5c30gsqm3k/lambda_cmcc45_fd.csv?rlkey=w7xlibvxnc2etc3iliog960dq&dl=1", stringsAsFactors = F)
geolambba_cmc85_fd <- read.csv("https://www.dropbox.com/scl/fi/d8uv2mbb2g47ywly0cz63/data_cmc85_fd.csv?rlkey=o4wcrp7hkqmdyow19eue8e1dh&dl=1", stringsAsFactors = F)
prob_lambda_cmc45_fd<-c()
dim(geo_lambba_cmc45_fd)
for(l in 1:ncol(geo_lambba_cmc45_fd)){
prob_lambda_cmc45_fd[l]<-mean(geo_lambba_cmc45_fd[,l]>1,na.rm=T)
}
lam_prob_cmc45_fd<-data.frame(climate_cmc_45_values[,9:10],Prlambda=prob_lambda_cmc45_fd)
(lambda_map_cmc45_fd <- ggplot()+
# geom_map(data = outline_map, map = outline_map, aes(map_id = region), color = "grey", linewidth = .1, fill = "#FAF9F6")+
# coord_sf(xlim = c(-110,-90), ylim = c(25,45)) +
geom_tile(data = lam_prob_cmc45_fd, aes(x = x, y = y, fill = Prlambda))+
annotate(geom="text", x=-100, y=41, label="RCP4.5",
color="grey",size = 3)+
scale_fill_gradientn(
name = expression("Pr " (lambda) > 1),
colours = terrain.colors(10),
breaks = seq(0, 1, 0.2))+
theme_light()+
theme(strip.background = element_blank(),
strip.text  = element_text(face = "italic", color = "black"))+
labs(x = "Longitude", y = "Latitude",title="C") )
prob_lambda_cmc85_fd<-c()
dim(geo_lambba_cmc85_fd)
dim(geolambba_cmc85_fd)
prob_lambda_cmc85_fd<-c()
dim(geolambba_cmc85_fd)
for(l in 1:ncol(geolambba_cmc85_fd)){
prob_lambda_cmc85_fd[l]<-mean(geolambba_cmc85_fd[,l]>1,na.rm=T)
}
lam_prob_cmc85_fd<-data.frame(climate_cmc_85_values[,9:10],Prlambda=prob_lambda_cmc85_fd)
(lambda_map_cmc85_fd <- ggplot()+
# geom_map(data = outline_map, map = outline_map, aes(map_id = region), color = "grey", linewidth = .1, fill = "#FAF9F6")+
# coord_sf(xlim = c(-110,-90), ylim = c(25,45)) +
geom_tile(data = lam_prob_cmc85_fd, aes(x = x, y = y, fill = Prlambda))+
annotate(geom="text", x=-100, y=41, label="RCP8.5",
color="grey",size = 3)+
scale_fill_gradientn(
name = expression("Pr " (lambda) > 1),
colours = terrain.colors(10),
breaks = seq(0, 1, 0.2))+
theme_light()+
theme(strip.background = element_blank(),
strip.text  = element_text(face = "italic", color = "black"))+
labs(x = "Longitude", y = "Latitude",title="C") )
Fig_geoPrlambdaprojection_fd_cmc<-ggarrange(lambda_map_Prpast_fd, lambda_map_Prcurrent_fd, lambda_map_cmc45_fd, lambda_map_cmc85_fd,common.legend = TRUE)
ggsave("/Users/jm200/Library/CloudStorage/Dropbox/Miller Lab/github/POAR-Forecasting/Manuscript/Figures/Fig_geoPrlambdaprojection_fd_cmc.pdf", Fig_geoPrlambdacmcprojection_fd_acc, width = 5, height = 7)
